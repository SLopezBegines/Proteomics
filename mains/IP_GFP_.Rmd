
# 1. Importing data

## Loading functions
```{r}
rm(list=ls())
gc()
output_path <- "./output/IP_GFP/mixed_splited_imputation/"
output_path <- "./output/IP_GFP/mixed_splited_imputation/outlier_removed/"

```


```{r}
image_number <- 1
kegg_organism = "mmu"#dre for Danio rerio, hsa for Homo sapiens, mmu for Mus musculus
species <- 10090 #9606 for Human, 10090 for mouse, 7955 for zebrafish
organism <- "org.Mm.eg.db" #"org.Hs.eg.db"
```

```{r}
source("../code/global_variables.R")
source("../code/01_loading_data.R")
source("../code/03_cleaning_data.R")
source("../code/04_data_analysis.R")
```



```{r}
# Select input data file
prot_data <- readxl::read_xlsx(path = "../rawdata/IP_GFP_Lipo.xlsx")
loading_data(prot_data)

```

# 2. Experiment Design
```{r}
# Experiment design ####
# You just need modify script in Experiment heading
comparisons <- c("WT_vs_TG","L115R_vs_TG","L116_vs_TG","L115R_vs_WT", "L116_vs_WT","L116_vs_L115R")

label <- c("TG_1", "TG_2","TG_3","TG_4",
           "WT_1","WT_2","WT_3","WT_4",
           "L115R_1","L115R_2","L115R_3","L115R_4",
           "L116_1","L116_2","L116_3","L116_4")
label_columns <- label
columns_to_rename <- label

condition <- as.factor(c("TG","TG","TG","TG",
                         "WT","WT","WT","WT",
                         "L115R","L115R","L115R","L115R",
                         "L116","L116","L116","L116"))
replicate <- c(1,2,3,4,
               1,2,3,4,
               1,2,3,4,
               1,2,3,4)


experiment <- rep("IP",length(replicate))

Exp_design <- cbind.data.frame(label,condition,replicate,columns_to_rename, experiment)
Exp_design


print(Exp_design)

Exp_design %>% 
  write_xlsx(paste0(output_path,"tables/experiment_desing.xlsx"))

```
## Outliers Removed
```{r}
# Experiment design ####
# You just need modify script in Experiment heading
comparisons <- c("WT_vs_TG","L115R_vs_TG","L116_vs_TG","L115R_vs_WT", "L116_vs_WT","L116_vs_L115R")

label <- c("TG_1", "TG_2","TG_3","TG_4",
           "WT_1","WT_2","WT_3","WT_4",
           "L115R_1", "L115R_2","L115R_3","L115R_4",
           "L116_1","L116_2","L116_4")
label_columns <- label
columns_to_rename <- label

condition <- as.factor(c("TG","TG","TG","TG",
                         "WT","WT","WT","WT",
                         "L115R","L115R","L115R","L115R",
                         "L116","L116","L116"))
replicate <- c(1,2,3,4,
               1,2,3,4,
               1,2,3,4,
               1,2,4)


experiment <- rep("IP",length(replicate))

Exp_design <- cbind.data.frame(label,condition,replicate,columns_to_rename, experiment)
Exp_design


print(Exp_design)

Exp_design %>% 
  write_xlsx(paste0(output_path,"tables/experiment_desing.xlsx"))

```
# 3. Data Cleaning

```{r}

source("../code/03_cleaning_data_mixed_imputation.R")

data_cleaning(prot_data, Exp_design, comparisons, output_path, fraction_NA =0.6, factor_SD_impute =0.05, mnar_var="zero")
```


# 4. Data Analysis
```{r}
source("../code/04_data_analysis.R")
# Load desired imputation file
data_analysis(mixed_splited_imputation, Exp_design, comparisons, output_path)
data_analysis(data_imp_knn, Exp_design, comparisons, output_path)

```


# 5. Plots
```{r}
#Change to 1 to print Barplots
print_barplots <- 0

source("../code/05_Plots.R")

```

# 6. GO
```{r}
#Use upregulated and downregulated genes independently
independent_UPDOWN <- 1
#Select type of ontology
ont <- "ALL"  # Can be "ALL", "BP", "CC", or "MF"
source("../code/06_GO.R")

```

# 7. Strings
```{r}
independent_UPDOWN <- 1
source("../code/07_Strings.R")
```


# 8. gseGO & KEGG
```{r}
#Use upregulated and downregulated genes independently
independent_UPDOWN <- 1
#Select type of ontology
ont <- "ALL"  # Can be "ALL", "BP", "CC", or "MF"
source("../code/08_gseGO.R")

source("../code/09_gseKEGG.R")

```

# 10. RBioAPI String and Panther
```{r}
source("../code/10_RBioApi_string.R") 
source("../code/11_RBioApi_panther.R")
```

# 11. Adj

```{r}
source("../code/13_GO_padj.R")

source("../code/15_gseGO_adj.R")
source("../code/13_gseKEGG_padj.R")


```

